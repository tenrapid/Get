// console is not available in all callbacks
var console = global.console;

var EventEmitter = require('events');
var emitter = new EventEmitter();

var projectManager = {
	open: {},
	recent: [],

	projectOpened: function(filename, win) {
		var index;

		if (filename) {
			this.open[filename] = win;

			index = this.recent.indexOf(filename);
			if (index >= 0) {
				this.recent.splice(index, 1);
			}
			this.recent.unshift(filename);
			if (this.recent.length > 5) {
				this.recent.pop();
			}

			emitter.emit('recentProjectsChanged', this.recent);
		}
	},

	projectClosed: function(filename, win) {
		delete this.open[filename];
	},

	isOpen: function(filename) {
		return filename in this.open;
	},

	getProjectWindow: function(filename) {
		return this.open[filename];
	},

	getRecentProjects: function() {
		return this.recent;
	},

	setRecentProjects: function(recent) {
		if (!this.recent.length && recent.length) {
			this.recent = recent;
		}
	},

	addListener: emitter.addListener.bind(emitter),
	on: emitter.addListener.bind(emitter),
	removeListener: emitter.removeListener.bind(emitter)

};

module.exports = projectManager;
